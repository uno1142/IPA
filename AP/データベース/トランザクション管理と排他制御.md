# トランザクション管理と排他制御

トランザクション→　一連の処理をひとまとめにしたもの。  
ex) 在庫数確認→在庫数更新  

排他制御とは、処理中のデータをロックして、他人が読み書きできないようにする機能。  


つまり、トランザクションの間、使用するデータをロックしておくことで誰かに割り込まれてデータの不整合が生じたりする恐れがなくなる。  

ロックの方法には共有ロックと専有ロックの２種類がある。  

### 共有ロック

ほかのユーザはデータを読み込むことはできるが、書くことはできない。  

### 専有ロック

ほかのユーザはデータを読み込むことも書くこともできない。  

ただしロック機能を使う際には注意しないと、複数のトランザクションがお互いに相手の使いたいデータをロックしてしまう  
デッドロックが起きてしまう可能性がある。  


## ACID特性

ACID特性とは、Atomicity(原子性)、Consistency(一貫性)、Isolation(隔離性)、Durability(耐久性)の４つからなる  
トランザクション処理に対して必須とされる特性のことである。  

A...Atomicity  
→トランザクションの処理結果は、「すべて実行されるか」「まったく実行されないか」のいずれかで終了すること。  
中途半端に一部だけ実行されるようなことは許容しない。  

C...Consistency  
→ データベースの内容が矛盾のない状態であること。トランザクションの処理結果が、矛盾を生じさせるようなことになってはいけない。  

I...Isolation  
複数のトランザクションを同時に実行した場合と、順番に実行した場合の処理結果が一致すること。  
排他制御をきちんとやって相互に影響させないようにする必要がある。  

D...Durability  
正常に終了したトランザクションの更新結果は、障害が発生してもデータベースから消失しないこと。  
なんらかの復旧手段が保証されていなければならない。  




##  ストアドプロシージャ

データベースを操作する一連の処理手順(SQL文)をひつつのプログラムにまとめ、DBMS側にあらかじめ保存しておくことを  
ストアドプロシージャと呼ぶ。  

たとえばクライアントサーバシステムにおいて、データベースサーバに保存されたストアドプロシージャは、  
そのプロシージャ名を指定するだけでクライアントから実行させることができる。  

メリット

- ちまちまとSQL文を流す必要がないのでネットワークの負担が軽減できる。
- SQL文の解析も済ませた即実行可能な形式なので処理速度の向上が見込める。  
